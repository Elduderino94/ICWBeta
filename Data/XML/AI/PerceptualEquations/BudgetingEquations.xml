<?xml version="1.0" ?>
<Equations>

	<!-- Utility equations -->
	<Can_Build_Defensive_Structures>
		(
			Variable_Self.IsFaction {Parameter_Faction = "Empire"} * 
			(Variable_Self.TechLevel >= 2) *
			Variable_Self.HasGroundbaseOfLevel {Parameter_Level = 2, Parameter_Count = 1}
		)
		+
		(
			Variable_Self.IsFaction {Parameter_Faction = "Rebel"} *
			(Variable_Self.TechLevel >= 2) *
			Variable_Self.HasGroundbaseOfLevel {Parameter_Level = 2, Parameter_Count = 1}
		)
		>= 1
	</Can_Build_Defensive_Structures>

	<Defensive_Structure_Count>
		Variable_Self.StructureCount {	Parameter_Type = "Empire_Ground_Shutter_Shield"
													,Parameter_Type = "Rebel_Ground_Shutter_Shield"
													,Parameter_Type = "E_Ground_Base_Shield"
													,Parameter_Type = "R_Ground_Base_Shield"
													,Parameter_Type = "E_Galactic_Turbolaser_Tower_Defenses"
													,Parameter_Type = "R_Galactic_Turbolaser_Tower_Defenses"
													,Parameter_Type = "Ground_Ion_Cannon"
													,Parameter_Type = "Ground_Empire_Hypervelocity_Gun"
													,Parameter_Type = "Ground_Rebel_Hypervelocity_Gun"
													,Parameter_Type = "Ground_Magnepulse_Cannon"
													,Parameter_Type = "Ground_Gravity_Generator"
													} 
	</Defensive_Structure_Count>

	<!-- Have we met the desired ratio of defensive structures to planets controlled?
	-->
	<Has_Enough_Defensive_Structures>
		(0.3 - (Function_Defensive_Structure_Count.Evaluate / Variable_Self.PlanetsControlledUnnormalized ))
		> 0.0
	</Has_Enough_Defensive_Structures>
	
	<!-- This is 1 unless FoW is on for the AI -->
	<GenericSpaceTargetedOffensiveBudgetAllocation>
		Game.ForceVisibility
	</GenericSpaceTargetedOffensiveBudgetAllocation>
	
	<GenericSpaceDefensiveBudgetAllocation>
		0.5
	</GenericSpaceDefensiveBudgetAllocation>
	
	<!-- This is 0 unless FoW is on for the AI -->
	<GenericSpaceUntargetedOffensiveBudgetAllocation>
		1.0 - Game.ForceVisibility
	</GenericSpaceUntargetedOffensiveBudgetAllocation>

	<!-- Used to determine the funds to be spent from the galactic budget on a land tactical game.
		We like to spend more on planets that are:
			valuable
			have a large ground force investment
			have a large ground infrastructure investment
			scale by a magic number
		NOTE: we're not scaling by the number of open build pads, because if we can't build, the
		over-allocated money simply wont be spent.
	 -->
	<Land_Tactical_Budget>
		(
			1 * Function_GenericPlanetValue.Evaluate + 
			2 * Variable_Target.FriendlyForce.GroundTotal + 
			3 * Variable_Target.GroundbaseLevel
		) / 5
		* 2500
		+
		200
	</Land_Tactical_Budget>

	<Land_Tactical_Budget_Clamped>
		clamp(	Function_Land_Tactical_Budget.Evaluate,
					0,
					Variable_Self.CreditsUnnormalized / (Variable_Self.PlanetsControlled + 1)
				)
	</Land_Tactical_Budget_Clamped>

	<!-- Offense-oriented budget. The below usually evaluates to ~13 -->
	<GenericOffensiveBudgetAllocation>
		7.2 + Variable_Self.PlanetsControlled
		+
		(6.0 * (1.0 - Function_Has_Enough_Space_Force_Globally.Evaluate))
	</GenericOffensiveBudgetAllocation>
	
	<!-- Infrastructure budget. Usually evaluates to ~6 -->
	<GenericInfrastructureBudgetAllocation>
		5.0 
		* 
		(2.5 - Variable_Self.MaxedStarbases - Variable_Self.MaxedGroundbases) 
		*
		(1.0 + 2.0 * (6 > (Variable_Self.StructureCount {Parameter_Type = "Rebel_Ground_Mining_Facility", 
															Parameter_Type = "Empire_Ground_Mining_Facility", 
															Parameter_Type = "U_Ground_Mining_Facility",
															Parameter_Type = "Generic_Tradestation" })))
		+
		3.0 * (Variable_Self.NumStarbaseOfLevel {Parameter_Level = 3} == 0)
	</GenericInfrastructureBudgetAllocation>
	
	<!-- Clean out the MajorItem budget if it gets bloated and isn't being used, or if we don't own many planets -->
	<Flush_MajorItem_Budget>
		(Variable_Self.ActiveGoals {Parameter_Category = AIGoalCategoryType[MajorItem]} == 0)
		*
		(
			(Variable_Self.BudgetAllocation{Parameter_Category = AIGoalCategoryType[MajorItem]} * Variable_Self.CreditsUnnormalized > 20000)
			*
			(1 - Function_Allow_SuperCapital_Production.Evaluate)
			+
			(0.1 > Variable_Self.PlanetsControlled)
		)
	</Flush_MajorItem_Budget>
	
	
	<!-- Trickle funds into the major item budget -->
	<!-- Increase if we want to build our capital but don't have the funds -->
	<!-- Increase if we want to build a company -->
	<!-- Increase if we can build super stations -->
	<!-- Usually evaluates to ~6 -->
	<GenericMajorItemBudgetAllocation>
		Variable_Self.PlanetsControlled
		+
		(
			(1 - Function_Has_Capital_Building.Evaluate)
			* 
			10
			+
			(1 - Function_Has_Company.Evaluate)
			*
			4
			+
			Variable_Self.IsFaction {Parameter_Faction = "Rebel", Parameter_Faction = "Underworld", Parameter_Faction = "Pentastar", Parameter_Faction = "Hutts", Parameter_Faction = "Pirates", Parameter_Faction = "Empire"}
			*
			(5 > Variable_Self.StructureCount {Parameter_Type = "Oto", Parameter_Type = "Validusia", Parameter_Type = "Empress_Station", Parameter_Only_Consider_Complete = 1.0})
			*
			4
		)
	</GenericMajorItemBudgetAllocation>
	
	<!-- For smaller GCs we want a lower major item budget, otherwise saving up takes a long time -->
	<GenericLowMajorItemBudgetAllocation>
		Variable_Self.PlanetsControlled
		+
		(
			(1 - Function_Has_Capital_Building.Evaluate)
			* 
			10
			+
			Variable_Self.IsFaction {Parameter_Faction = "Rebel", Parameter_Faction = "Underworld", Parameter_Faction = "Pentastar", Parameter_Faction = "Hutts", Parameter_Faction = "Pirates", Parameter_Faction = "Empire"}
			*
			(5 > Variable_Self.StructureCount {Parameter_Type = "Oto", Parameter_Type = "Validusia", Parameter_Type = "Empress_Station", Parameter_Only_Consider_Complete = 1.0})
		)
	</GenericLowMajorItemBudgetAllocation>
	
	<!-- Warlords tilt more strongly to attack than construction -->
	<WarlordOffensiveBudgetAllocation>
		1.5 * Function_GenericOffensiveBudgetAllocation.Evaluate
	</WarlordOffensiveBudgetAllocation>
	
	<WarlordInfrastructureBudgetAllocation>
		Function_GenericInfrastructureBudgetAllocation.Evaluate
	</WarlordInfrastructureBudgetAllocation>
	
	<WarlordMajorItemBudgetAllocation>
		Function_GenericMajorItemBudgetAllocation.Evaluate
	</WarlordMajorItemBudgetAllocation>
	
	<!-- Remnant tilts more towards infrastructure and big stuff -->
	<RemnantOffensiveBudgetAllocation>
		0.9 * Function_GenericOffensiveBudgetAllocation.Evaluate
	</RemnantOffensiveBudgetAllocation>
	
	<RemnantInfrastructureBudgetAllocation>
		1.4 * Function_GenericInfrastructureBudgetAllocation.Evaluate
	</RemnantInfrastructureBudgetAllocation>
	
	<RemnantMajorItemBudgetAllocation>
		1.2 * Function_GenericMajorItemBudgetAllocation.Evaluate
	</RemnantMajorItemBudgetAllocation>	
	
	<Era_One>
		(Variable_Self.TechLevel == 1)
		+
		(Variable_Self.TechLevel == 0) * Variable_Self.IsFaction {Parameter_Faction = "Rebel"}
	</Era_One>
	
	<Era_Two>
		(Variable_Self.TechLevel == 2)
		+
		(Variable_Self.TechLevel == 1) * Variable_Self.IsFaction {Parameter_Faction = "Rebel"}
	</Era_Two>
	
	<Era_Three>
		(Variable_Self.TechLevel == 3)
		+
		(Variable_Self.TechLevel == 2) * Variable_Self.IsFaction {Parameter_Faction = "Rebel"}
	</Era_Three>
	
	<Era_Four>
		(Variable_Self.TechLevel == 4)
		+
		(Variable_Self.TechLevel == 3) * Variable_Self.IsFaction {Parameter_Faction = "Rebel"}
	</Era_Four>
	
	<Era_Five>
		(Variable_Self.TechLevel == 5)
		+
		(Variable_Self.TechLevel == 4) * Variable_Self.IsFaction {Parameter_Faction = "Rebel"}
	</Era_Five>
	
	<Pentastar_Aggro_On>
		Variable_Self.TechLevel == 3
	</Pentastar_Aggro_On>
	
	<Pentastar_Aggro_Off>
		Variable_Self.TechLevel > 3
	</Pentastar_Aggro_Off>
	
	<!-- Pentastar is very low aggro by default-->
	<PentastarOffensiveBudgetAllocation>
		0.7 * Function_GenericOffensiveBudgetAllocation.Evaluate
	</PentastarOffensiveBudgetAllocation>
	
	<PentastarInfrastructureBudgetAllocation>
		1.2 * Function_GenericInfrastructureBudgetAllocation.Evaluate
	</PentastarInfrastructureBudgetAllocation>
	
	<PentastarMajorItemBudgetAllocation>
		Function_GenericMajorItemBudgetAllocation.Evaluate
	</PentastarMajorItemBudgetAllocation>	
	
	<EotHDefaultOffensiveBudgetAllocation>
		0.5 * Function_GenericOffensiveBudgetAllocation.Evaluate
	</EotHDefaultOffensiveBudgetAllocation>
	
	<EotHDefaultInfrastructureBudgetAllocation>
		Function_GenericInfrastructureBudgetAllocation.Evaluate
	</EotHDefaultInfrastructureBudgetAllocation>
	
	<EotHDefaultMajorItemBudgetAllocation>
		Function_GenericMajorItemBudgetAllocation.Evaluate
	</EotHDefaultMajorItemBudgetAllocation>
	
	<EotH_Aggro_On>
		Variable_Self.TechLevel > 3
	</EotH_Aggro_On>
	
</Equations>
